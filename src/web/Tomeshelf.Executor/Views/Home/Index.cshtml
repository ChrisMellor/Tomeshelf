@model ExecutorConfigurationViewModel
@{
    ViewData["Title"] = "Executor Scheduler";
}

<h1 class="mb-3">Executor Scheduler</h1>

@if (TempData["StatusMessage"] is string statusMessage)
{
    <div class="alert alert-success">@statusMessage</div>
}

<div class="mb-4">
    <form asp-action="Toggle" method="post">
        @Html.AntiForgeryToken()
        <input type="hidden" name="enabled" value="@(Model.Enabled
                                                           ? "false"
                                                           : "true")"/>
        <button class="btn @(Model.Enabled
                                   ? "btn-danger"
                                   : "btn-success")" type="submit">
            @(Model.Enabled
                    ? "Disable Scheduler"
                    : "Enable Scheduler")
        </button>
        <span class="ms-2 badge @(Model.Enabled
                                        ? "text-bg-success"
                                        : "text-bg-secondary")">
            @(Model.Enabled
                    ? "Enabled"
                    : "Disabled")
        </span>
    </form>
</div>

<section class="mb-5">
    <h2 class="h4">Configured Endpoints</h2>
    @if (Model.Endpoints.Count == 0)
    {
        <p class="text-muted">No endpoints have been configured yet.</p>
    }
    else
    {
        <div class="table-responsive">
            <table class="table table-striped">
                <thead>
                <tr>
                    <th>Name</th>
                    <th>Method</th>
                    <th>URL</th>
                    <th>Cron</th>
                    <th>Headers</th>
                    <th>Status</th>
                    <th></th>
                </tr>
                </thead>
                <tbody>
                @foreach (var endpoint in Model.Endpoints)
                {
                    <tr>
                        <td>@endpoint.Name</td>
                        <td>@endpoint.Method</td>
                        <td class="text-break">@endpoint.Url</td>
                        <td>@endpoint.Cron</td>
                        <td>@endpoint.HeadersDisplay</td>
                        <td>
                            <span class="badge @(endpoint.Enabled
                                                       ? "text-bg-success"
                                                       : "text-bg-secondary")">
                                @(endpoint.Enabled
                                        ? "Enabled"
                                        : "Disabled")
                            </span>
                        </td>
                        <td class="text-end">
                            <a class="btn btn-sm btn-outline-primary" asp-action="Edit" asp-route-name="@endpoint.Name">Edit</a>
                            <form asp-action="Delete" method="post" class="d-inline">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="name" value="@endpoint.Name"/>
                                <button class="btn btn-sm btn-outline-danger" type="submit" onclick="return confirm('Delete @endpoint.Name?');">Delete</button>
                            </form>
                        </td>
                    </tr>
                }
                </tbody>
            </table>
        </div>
    }
</section>

<div class="mt-4">
    <a class="btn btn-primary me-2" asp-action="Create">Add Endpoint</a>
    <a class="btn btn-outline-secondary" asp-action="Ping">Ping Endpoint</a>
</div>
